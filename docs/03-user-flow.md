# 03. User Flow

## 1. GUI 애플리케이션 흐름

### 1.1 애플리케이션 시작

```
┌─────────────────────────────────────────────────────────────┐
│                    앱 실행 (python src/app.py)              │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼
              ┌────────────────────────┐
              │  .env.local 로드       │
              │  (API 키 자동 설정)    │
              └───────────┬────────────┘
                          │
                          ▼
              ┌────────────────────────┐
              │  SQLite DB 연결        │
              │  (data/db/chat_history.db)│
              └───────────┬────────────┘
                          │
                          ▼
              ┌────────────────────────┐
              │  메인 윈도우 표시      │
              │  - 채팅방 목록 로드    │
              │  - 대시보드 탭 활성화  │
              └────────────────────────┘
```

---

### 1.2 채팅방 관리 흐름

```
┌─────────────────────────────────────────────────────────────┐
│                       메인 화면                             │
├─────────────────────────────────────────────────────────────┤
│  ┌───────────────┐  ┌─────────────────────────────────────┐ │
│  │  채팅방 목록  │  │          콘텐츠 영역               │ │
│  │  ──────────── │  │  ┌─────────────────────────────────┐│ │
│  │  📁 개발팀│  │  │  📊 대시보드 | 📅 날짜별 | 🔗 URL | 🔧 기타 ││ │
│  │  📁 스터디방  │  │  │─────────────────────────────────││ │
│  │               │  │  │                                 ││ │
│  │  [➕ 채팅방]  │  │  │    통계 / 요약 / URL 정보      ││ │
│  │  [📤 업로드]  │  │  │                                 ││ │
│  └───────────────┘  │  └─────────────────────────────────┘│ │
│                     └─────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. 주요 사용 시나리오

### 시나리오 A: 새 채팅방 추가 및 파일 업로드

```
[➕ 채팅방 만들기] 클릭
        │
        ▼
┌────────────────────────┐
│  채팅방 이름 입력      │
│  예: "개발팀"      │
└───────────┬────────────┘
            │
            ▼
┌────────────────────────┐
│  채팅방 생성 완료      │
│  - DB에 레코드 생성    │
│  - 디렉터리 생성       │
│    data/original/개발팀/
│    data/summary/개발팀/
└───────────┬────────────┘
            │
            ▼
[📤 파일 업로드] 클릭
        │
        ▼
┌────────────────────────┐
│  채팅방 선택           │
│  파일 선택 (.txt)      │
└───────────┬────────────┘
            │
            ▼
┌────────────────────────┐
│  백그라운드 처리       │
│  - 파일 파싱           │
│  - 날짜별 그룹화       │
│  - DB 저장 (중복 체크) │
│  - 파일 저장           │
│  - 기존 요약 무효화    │
└───────────┬────────────┘
            │
            ▼
┌────────────────────────┐
│  업로드 완료 알림      │
│  "2024-01-20 ~ 01-25   │
│   총 1,234개 메시지"   │
└────────────────────────┘
```

---

### 시나리오 B: 요약 생성

```
[🔄 요약 생성] 클릭
        │
        ▼
┌────────────────────────┐
│  요약 옵션 다이얼로그  │
│  ──────────────────── │
│  📅 날짜 범위:         │
│    ● 요약 필요한 날짜만│
│    ○ 오늘             │
│    ○ 어제~오늘        │
│    ○ 엇그제~오늘      │
│    ○ 전체 일자        │
│  ──────────────────── │
│  🤖 LLM 선택:          │
│    [Z.AI GLM ▼]        │
│    API 상태: ✅ 설정됨 │
│  ──────────────────── │
│  ☑ 이미 완료된 날짜 건너뛰기│
│  ──────────────────── │
│  📊 요약 현황:         │
│    전체: 30일 / 완료: 25일│
│    신규: 3일 / 업데이트: 2일│
└───────────┬────────────┘
            │
            ▼
상태바에 비모달 프로그레스 위젯 표시 (메인 윈도우 조작 가능)
┌────────────────────────────────────────────────────────────────┐
│  ⏳ 요약 중...   [🤖 [채팅방] Z.AI GLM 요약 중... ▓▓▓░░ ❌]  (15:31:10) │
└───────────┬────────────────────────────────────────────────────┘
            │
            ▼ (완료 시 위젯 제거)
┌────────────────────────────────────────────────────────────────┐
│  ✅ [채팅방] 요약 완료                                 (15:32:45) │
└────────────────────────────────────────────────────────────────┘
```

---

### 시나리오 C: 날짜별 요약 조회

```
[📅 날짜별 요약] 탭 클릭
        │
        ▼
┌────────────────────────────────────────────────────┐
│  ◀ 이전    📅 2024년 01월 23일    📆    다음 ▶   │
├────────────────────────────────────────────────────┤
│  📊 123개 메시지 / 요약 있음                       │
├────────────────────────────────────────────────────┤
│                                                    │
│  ## 🌟 3줄 요약                                    │
│  1. 새 프로젝트 킥오프 회의 진행                   │
│  2. 기술 스택 논의 (Python, FastAPI)               │
│  3. 다음 주 스프린트 계획 수립                     │
│                                                    │
│  ## ❓ Q&A 및 해결된 문제                          │
│  - Q: FastAPI vs Django?                           │
│    A: 빠른 개발에는 FastAPI 권장                   │
│  ...                                               │
│                                                    │
└────────────────────────────────────────────────────┘
```

---

### 시나리오 D: URL 정보 조회

```
[🔗 URL 정보] 탭 클릭
        │
        ▼
┌────────────────────────────────────────────────────┐
│  🔗 공유된 URL 목록      0개 URL  [🔄 동기화] [📂 파일 복구] │
├────────────────────────────────────────────────────┤
│                                                    │
│  📊 총 415개 URL                                   │
│  ─────────────────────────────────────────────────│
│                                                    │
│  🔥 최근 3일 (25개)                                │
│  ─────────────────────────────────────────────────│
│    #1 https://example.com/today                   │
│        : 오늘 공유된 링크                          │
│                                                    │
│  📅 최근 1주 (98개)                                │
│  ─────────────────────────────────────────────────│
│    #1 https://example.com/weekly                  │
│        : 이번 주 공유된 링크                       │
│                                                    │
│  📚 전체 URL (415개)                               │
│  ─────────────────────────────────────────────────│
│    #1 https://fastapi.tiangolo.com                │
│        : FastAPI 공식 문서                         │
│    #2 https://github.com/example/project          │
│        : 프로젝트 레포 / 소스코드 저장소           │
│  ...                                               │
└────────────────────────────────────────────────────┘
```

---

### 시나리오 E: 복구 기능

```
[도구] 메뉴 → [🗄️ DB 전체 복구...] 또는 [💬 채팅방 복구...]
        │
        ▼
┌────────────────────────┐
│  확인 다이얼로그       │
│  (복구 대상 표시)      │
│  [취소]     [복구]     │
└───────────┬────────────┘
            │
            ▼
┌────────────────────────┐
│  복구 완료 알림        │
└────────────────────────┘

* DB 전체 복구: 파괴적 (기존 DB 삭제 후 파일에서 재구축)
* 채팅방 복구: 비파괴적 (파일 디렉터리에 있지만 DB에 없는 채팅방만 추가)
```

---

## 3. CLI 사용 (수동 요약용, 레거시)

`src/manual/` 디렉터리의 CLI 스크립트는 GUI 앱과 별개로 동작합니다.
DB/FileStorage를 사용하지 않으며, 결과는 `output/` 디렉터리에 저장됩니다.

### Full 스크립트 (상세 요약)
src/ 모듈을 재사용합니다 (`full_config`, `parser`, `chat_processor`, `url_extractor`).

```bash
python src/manual/full_date_summary.py data/채팅방.txt
python src/manual/full_yesterday_summary.py --llm minimax data/
python src/manual/full_2days_summary.py data/채팅방.txt
python src/manual/full_today_summary.py --llm glm data/
```

### Simple 스크립트 (간결 요약, 음슴체)
자체 내장 구현(`SimpleConfig`, `SimpleParser`, `SimpleLLMClient`)으로 외부 모듈 의존 없이 단독 실행 가능합니다.

```bash
python src/manual/simple_date_summary.py data/채팅방.txt
python src/manual/simple_today_summary.py --llm glm data/
python src/manual/simple_2days_summary.py data/채팅방.txt
python src/manual/simple_yesterday_summary.py --llm minimax data/
```

### 실행 모드
```bash
# 단일 파일 지정
python src/manual/<스크립트>.py <파일.txt>

# 디렉터리 일괄 처리
python src/manual/<스크립트>.py <디렉터리>

# LLM 선택
python src/manual/<스크립트>.py --llm chatgpt <파일.txt>

# 인자 없이 실행 → 대화형 모드
python src/manual/<스크립트>.py
```

---

## 4. 상태바 표시

```
┌──────────────────────────────────────────────────────────────────────────┐
│  ✅ 준비                                                      (15:30:25) │
│  ⏳ 요약 중...  [🤖 [채팅방] GLM 요약 중... ▓▓▓░░ ❌]         (15:31:10) │
│  ✅ [채팅방] 요약 완료                                         (15:32:45) │
│  ❌ 요약 생성 실패: 채팅방                                     (15:32:45) │
└──────────────────────────────────────────────────────────────────────────┘

아이콘 의미:
  ✅ 성공/준비 완료
  ⏳ 작업 진행 중
  ❌ 실패
  ⚠️ 경고
  ℹ️ 정보
```
