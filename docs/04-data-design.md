# 04. Data Design

## 1. ë°ì´í„° ì €ì¥ ì „ëµ

ì´ í”„ë¡œì íŠ¸ëŠ” **ì´ì¤‘ ì €ì¥** ì „ëµì„ ì‚¬ìš©í•©ë‹ˆë‹¤:
1. **SQLite ë°ì´í„°ë² ì´ìŠ¤**: ë¹ ë¥¸ ì¡°íšŒ ë° í†µê³„
2. **íŒŒì¼ ì €ì¥ì†Œ**: ë°±ì—… ë° ë³µêµ¬ìš© Markdown íŒŒì¼

---

## 2. SQLite ë°ì´í„°ë² ì´ìŠ¤

### 2.1 ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼
```
data/db/chat_history.db
```

### 2.2 í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ

#### chat_rooms (ì±„íŒ…ë°©)
| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| id | INTEGER | Primary Key |
| name | VARCHAR(255) | ì±„íŒ…ë°© ì´ë¦„ |
| file_path | TEXT | ì›ë³¸ íŒŒì¼ ê²½ë¡œ |
| created_at | DATETIME | ìƒì„±ì¼ |
| updated_at | DATETIME | ìˆ˜ì •ì¼ |

#### messages (ë©”ì‹œì§€)
| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| id | INTEGER | Primary Key |
| room_id | INTEGER | FK â†’ chat_rooms.id |
| date | DATE | ë©”ì‹œì§€ ë‚ ì§œ |
| time | VARCHAR(20) | ë©”ì‹œì§€ ì‹œê°„ |
| sender | VARCHAR(100) | ë°œì‹ ì |
| content | TEXT | ë©”ì‹œì§€ ë‚´ìš© |
| created_at | DATETIME | ìƒì„±ì¼ |

**UniqueConstraint**: (room_id, date, time, sender, content)

#### summaries (ìš”ì•½)
| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| id | INTEGER | Primary Key |
| room_id | INTEGER | FK â†’ chat_rooms.id |
| summary_date | DATE | ìš”ì•½ ëŒ€ìƒ ë‚ ì§œ |
| summary_type | VARCHAR(50) | ìš”ì•½ íƒ€ì… (full/simple) |
| content | TEXT | ìš”ì•½ ë‚´ìš© |
| llm_provider | VARCHAR(50) | ì‚¬ìš©ëœ LLM |
| created_at | DATETIME | ìƒì„±ì¼ |

#### urls (ì¶”ì¶œëœ URL)
| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| id | INTEGER | Primary Key |
| room_id | INTEGER | FK â†’ chat_rooms.id |
| url | TEXT | URL (ì •ê·œí™”ë¨) |
| descriptions | TEXT | ì„¤ëª… ëª©ë¡ (" / " êµ¬ë¶„) |
| source_date | DATE | ì¶œì²˜ ë‚ ì§œ |
| created_at | DATETIME | ìƒì„±ì¼ |
| updated_at | DATETIME | ìˆ˜ì •ì¼ |

**UniqueConstraint**: (room_id, url)

#### sync_logs (ë™ê¸°í™” ë¡œê·¸)
| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| id | INTEGER | Primary Key |
| room_id | INTEGER | FK â†’ chat_rooms.id |
| sync_type | VARCHAR(50) | ë™ê¸°í™” íƒ€ì… |
| status | VARCHAR(20) | ìƒíƒœ (success/failed) |
| message | TEXT | ìƒì„¸ ë©”ì‹œì§€ |
| created_at | DATETIME | ìƒì„±ì¼ |

---

## 3. íŒŒì¼ ì €ì¥ì†Œ êµ¬ì¡°

### 3.1 ë””ë ‰í„°ë¦¬ êµ¬ì¡°
```
data/
â”œâ”€â”€ db/                          # SQLite ë°ì´í„°ë² ì´ìŠ¤
â”‚   â””â”€â”€ chat_history.db
â”œâ”€â”€ original/                    # ì›ë³¸ ëŒ€í™” (íŒŒì‹±ëœ ê²°ê³¼)
â”‚   â”œâ”€â”€ .gitkeep
â”‚   â””â”€â”€ <ì±„íŒ…ë°©ëª…>/
â”‚       â”œâ”€â”€ <ì±„íŒ…ë°©ëª…>_20240120_full.md
â”‚       â”œâ”€â”€ <ì±„íŒ…ë°©ëª…>_20240121_full.md
â”‚       â””â”€â”€ ...
â”œâ”€â”€ summary/                     # LLM ìš”ì•½ ê²°ê³¼
â”‚   â”œâ”€â”€ .gitkeep
â”‚   â””â”€â”€ <ì±„íŒ…ë°©ëª…>/
â”‚       â”œâ”€â”€ <ì±„íŒ…ë°©ëª…>_20240120_summary.md
â”‚       â”œâ”€â”€ <ì±„íŒ…ë°©ëª…>_20240121_summary.md
â”‚       â””â”€â”€ ...
â””â”€â”€ url/                         # URL ì¶”ì¶œ ê²°ê³¼
    â””â”€â”€ <ì±„íŒ…ë°©ëª…>/
        â”œâ”€â”€ <ì±„íŒ…ë°©ëª…>_urls_recent.md     # ìµœê·¼ 3ì¼
        â”œâ”€â”€ <ì±„íŒ…ë°©ëª…>_urls_weekly.md     # ìµœê·¼ 1ì£¼
        â””â”€â”€ <ì±„íŒ…ë°©ëª…>_urls_all.md        # ì „ì²´
```

### 3.2 íŒŒì¼ ëª…ëª… ê·œì¹™

| íŒŒì¼ ìœ í˜• | í˜•ì‹ | ì˜ˆì‹œ |
|-----------|------|------|
| ì›ë³¸ ëŒ€í™” | `<ì±„íŒ…ë°©>_YYYYMMDD_full.md` | `ë°”ì´ë¸Œë©ìŠ¤_20240120_full.md` |
| ìš”ì•½ | `<ì±„íŒ…ë°©>_YYYYMMDD_summary.md` | `ë°”ì´ë¸Œë©ìŠ¤_20240120_summary.md` |
| URL (ìµœê·¼3ì¼) | `<ì±„íŒ…ë°©>_urls_recent.md` | `ë°”ì´ë¸Œë©ìŠ¤_urls_recent.md` |
| URL (ìµœê·¼1ì£¼) | `<ì±„íŒ…ë°©>_urls_weekly.md` | `ë°”ì´ë¸Œë©ìŠ¤_urls_weekly.md` |
| URL (ì „ì²´) | `<ì±„íŒ…ë°©>_urls_all.md` | `ë°”ì´ë¸Œë©ìŠ¤_urls_all.md` |

---

## 4. ì…ë ¥ ë°ì´í„° í˜•ì‹

### 4.1 ì¹´ì¹´ì˜¤í†¡ ë‚´ë³´ë‚´ê¸° íŒŒì¼ (.txt)

**PC/Mac í˜•ì‹**:
```
[ì±„íŒ…ë°© ì´ë¦„] ì¹´ì¹´ì˜¤í†¡ ëŒ€í™”
ì €ì¥í•œ ë‚ ì§œ : 2024-01-24 15:00:00

--------------- 2024ë…„ 1ì›” 20ì¼ í† ìš”ì¼ ---------------
[í™ê¸¸ë™] [ì˜¤ì „ 10:00] ì•ˆë…•í•˜ì„¸ìš”
[ê¹€ì² ìˆ˜] [ì˜¤ì „ 10:01] ë„¤, ì•ˆë…•í•˜ì„¸ìš”!
[í™ê¸¸ë™] [ì˜¤ì „ 10:02] ì˜¤ëŠ˜ íšŒì˜ ì‹œê°„ì´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?

--------------- 2024ë…„ 1ì›” 21ì¼ ì¼ìš”ì¼ ---------------
[í™ê¸¸ë™] [ì˜¤í›„ 2:00] íšŒì˜ë¡ ê³µìœ ë“œë¦½ë‹ˆë‹¤
[í™ê¸¸ë™] [ì˜¤í›„ 2:00] https://notion.so/meeting-notes
```

**ëª¨ë°”ì¼ í˜•ì‹**:
```
2024ë…„ 1ì›” 20ì¼ í† ìš”ì¼
í™ê¸¸ë™ : ì•ˆë…•í•˜ì„¸ìš”
ê¹€ì² ìˆ˜ : ë„¤, ì•ˆë…•í•˜ì„¸ìš”!
```

---

## 5. ë‚´ë¶€ ë°ì´í„° êµ¬ì¡°

### 5.1 ParseResult (parser.py)

```python
@dataclass
class ParseResult:
    messages_by_date: Dict[str, List[str]]
    # ì˜ˆì‹œ:
    # {
    #     "2024-01-20": [
    #         "[í™ê¸¸ë™] [ì˜¤ì „ 10:00] ì•ˆë…•í•˜ì„¸ìš”",
    #         "[ê¹€ì² ìˆ˜] [ì˜¤ì „ 10:01] ë„¤, ì•ˆë…•í•˜ì„¸ìš”!"
    #     ],
    #     "2024-01-21": [
    #         "[í™ê¸¸ë™] [ì˜¤í›„ 2:00] íšŒì˜ë¡ ê³µìœ ë“œë¦½ë‹ˆë‹¤"
    #     ]
    # }
    
    total_dates: int
    # ì˜ˆì‹œ: 2
```

### 5.2 LLM API ì‘ë‹µ êµ¬ì¡° (llm_client.py)

**ì„±ê³µ ì‹œ**:
```python
{
    "success": True,
    "content": "### ğŸŒŸ 3ì¤„ ìš”ì•½\n1. ...\n\n### â“ Q&A...",
    "usage": {
        "prompt_tokens": 1500,
        "completion_tokens": 800,
        "total_tokens": 2300
    }
}
```

**ì‹¤íŒ¨ ì‹œ**:
```python
{
    "success": False,
    "error": "API Error 401: Unauthorized"
}
```

### 5.3 URL ì¶”ì¶œ ê²°ê³¼ (url_extractor.py)

```python
# Dict[str, List[str]]
{
    "https://fastapi.tiangolo.com": ["FastAPI ê³µì‹ ë¬¸ì„œ"],
    "https://github.com/example": ["í”„ë¡œì íŠ¸ ë ˆí¬", "ì†ŒìŠ¤ì½”ë“œ ì €ì¥ì†Œ"],
    "https://notion.so/wiki": []  # ì„¤ëª… ì—†ìŒ
}
```

---

## 6. íŒŒì¼ í¬ë§·

### 6.1 ì›ë³¸ ëŒ€í™” íŒŒì¼ (*_full.md)

```markdown
# ë°”ì´ë¸Œë©ìŠ¤ - 2024-01-20 ëŒ€í™” ì›ë³¸

> ì´ 42ê°œ ë©”ì‹œì§€

---

[í™ê¸¸ë™] [ì˜¤ì „ 10:00] ì•ˆë…•í•˜ì„¸ìš”
[ê¹€ì² ìˆ˜] [ì˜¤ì „ 10:01] ë„¤, ì•ˆë…•í•˜ì„¸ìš”!
[í™ê¸¸ë™] [ì˜¤ì „ 10:02] ì˜¤ëŠ˜ íšŒì˜ ì‹œê°„ì´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?
...
```

### 6.2 ìš”ì•½ íŒŒì¼ (*_summary.md)

```markdown
# ë°”ì´ë¸Œë©ìŠ¤ - 2024-01-20 ìš”ì•½

> LLM: Z.AI GLM | ìƒì„±: 2024-01-25 15:30:00

---

### ğŸŒŸ 3ì¤„ ìš”ì•½
1. ìƒˆ í”„ë¡œì íŠ¸ í‚¥ì˜¤í”„ ë¯¸íŒ… ì§„í–‰
2. ê¸°ìˆ  ìŠ¤íƒ ë…¼ì˜ (Python, FastAPI)
3. ë‹¤ìŒ ì£¼ ìŠ¤í”„ë¦°íŠ¸ ê³„íš ìˆ˜ë¦½

### â“ Q&A ë° í•´ê²°ëœ ë¬¸ì œ
- Q: FastAPI vs Django?
- A: ë¹ ë¥¸ ê°œë°œì—ëŠ” FastAPI ê¶Œì¥

### ğŸ’¬ ì£¼ìš” í† í”½ & ë…¼ì˜
- í”„ë¡œì íŠ¸ ì¼ì • í˜‘ì˜
- ì—­í•  ë¶„ë‹´ ë…¼ì˜

### ğŸ’¡ ê¿€íŒ ë° ë„êµ¬ ì¶”ì²œ
- FastAPI ê³µì‹ ë¬¸ì„œ ì°¸ê³ 
- VS Code ì¶”ì²œ í™•ì¥ ê³µìœ 

### ğŸ”— ë§í¬/URL
- https://fastapi.tiangolo.com (FastAPI ê³µì‹)
- https://github.com/example/project (ë ˆí¬)

### ğŸ“… ì¼ì • ë° ê³µì§€
- ë‹¤ìŒ íšŒì˜: 1/22(ì›”) 14:00
```

### 6.3 URL ëª©ë¡ íŒŒì¼ (*_urls_*.md)

```markdown
# ğŸ”— [ë°”ì´ë¸Œë©ìŠ¤] URL ëª©ë¡ (ì „ì²´)

> ì´ 415ê°œ URL | ìƒì„±: 2024-01-25 15:30:00

---

#1 https://fastapi.tiangolo.com
    : FastAPI ê³µì‹ ë¬¸ì„œ

#2 https://github.com/example/project
    : í”„ë¡œì íŠ¸ ë ˆí¬ / ì†ŒìŠ¤ì½”ë“œ ì €ì¥ì†Œ

#3 https://notion.so/wiki/guide
    : ì„¤ëª… ì—†ìŒ
...
```

---

## 7. ë°ì´í„° ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜

### 7.1 ë³µêµ¬ íë¦„

```
data/original/ ìŠ¤ìº”
       â”‚
       â–¼
ì±„íŒ…ë°©ë³„ ë””ë ‰í„°ë¦¬ íƒìƒ‰
       â”‚
       â–¼
ê° *_full.md íŒŒì¼ íŒŒì‹±
       â”‚
       â–¼
DBì— ì±„íŒ…ë°© ìƒì„±/ê°±ì‹ 
       â”‚
       â–¼
ë©”ì‹œì§€ ì¶”ì¶œ â†’ DB ì €ì¥
       â”‚
       â–¼
data/summary/ ìŠ¤ìº”
       â”‚
       â–¼
ê° *_summary.md íŒŒì¼ ë¡œë“œ
       â”‚
       â–¼
DBì— ìš”ì•½ ì €ì¥
```

### 7.2 íŒŒì¼-DB ë™ê¸°í™” ê·œì¹™

1. **ì›ë³¸ íŒŒì¼ì´ ì§„ì‹¤ì˜ ì›ì²œ**: íŒŒì¼ ë‚´ìš©ì´ DBì™€ ë‹¤ë¥´ë©´ íŒŒì¼ ìš°ì„ 
2. **ìš”ì•½ ë¬´íš¨í™”**: ì›ë³¸ ë©”ì‹œì§€ ìˆ˜ ì¦ê°€ ì‹œ í•´ë‹¹ ë‚ ì§œ ìš”ì•½ ì‚­ì œ
3. **ì¤‘ë³µ ë©”ì‹œì§€ ì²˜ë¦¬**: ë™ì¼í•œ (ë‚ ì§œ, ì‹œê°„, ë°œì‹ ì, ë‚´ìš©) â†’ ìŠ¤í‚µ
